---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";
import { Image } from "astro:assets";

const posts = (await getCollection("blog")).sort((a, b) => {
	// First, prioritize pinned posts
	if (a.data.pinned && !b.data.pinned) return -1;
	if (!a.data.pinned && b.data.pinned) return 1;

	// Then sort by pubDate (newest first)
	return (b.data.pubDate?.valueOf() ?? 0) - (a.data.pubDate?.valueOf() ?? 0);
});
---

<BaseLayout>
	<section class="blog_index">
		<ul>
			{
				posts.map((post) => (
					<li>
						<a href={`/blog/${post.id}/`}>
							{post.data.heroImage && (
								<Image
									width={720}
									height={360}
									src={post.data.heroImage}
									alt=""
								/>
							)}
							<h4 class="title">{post.data.title}</h4>
							<p class="date">
								{post.data.pubDate && (
									<FormattedDate date={post.data.pubDate} />
								)}
							</p>
						</a>
					</li>
				))
			}
		</ul>
	</section>
</BaseLayout>

<style>
	/* Blog page styles */
	.blog_index {
		padding: 2rem 1rem;
		max-width: 80ch;
		margin: 0 auto;
	}

	.blog_index ul {
		display: flex;
		flex-wrap: wrap;
		gap: 2rem;
		list-style-type: none;
		margin: 0;
		padding: 0;
	}

	.blog_index ul li {
		width: calc(50% - 1rem);
	}

	.blog_index ul li * {
		text-decoration: none;
		transition: 0.2s ease;
	}

	.blog_index ul li:first-child {
		width: 100%;
		margin-bottom: 1rem;
		text-align: center;
	}

	.blog_index ul li:first-child img {
		width: 100%;
	}

	.blog_index ul li:first-child .title {
		font-size: 2.369rem;
	}

	.blog_index ul li img {
		margin-bottom: 0.5rem;
		border-radius: 12px;
	}

	.blog_index ul li a {
		display: block;
	}

	.blog_index .title {
		margin: 0;
		color: var(--black);
		line-height: 1;
	}

	.blog_index .date {
		margin: 0;
		color: rgb(var(--gray));
	}

	.blog_index ul li a:hover h4,
	.blog_index ul li a:hover .date {
		color: var(--accent);
	}

	.blog_index ul a:hover img {
		box-shadow: var(--box-shadow);
	}

	@media (max-width: 720px) {
		.blog_index ul {
			gap: 0.5em;
		}
		.blog_index ul li {
			width: 100%;
			text-align: center;
		}
		.blog_index ul li:first-child {
			margin-bottom: 0;
		}
		.blog_index ul li:first-child .title {
			font-size: 1.563em;
		}
	}

	@media (max-width: 960px) {
		.blog_index {
			width: 100%;
			max-width: 960px;
		}
	}
</style>
